<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <script src="https://js.tosspayments.com/v2/standard"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <script src="/WebContent/jquery.js" type="text/javascript"></script>
    <script src="/WebContent/common/common.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="payment.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/WebContent/common/common.css"
    />
    <title>결제하기</title>
  </head>
  <body>
    <div id="header1"></div>
    <!-- 결제하기 title -->
    <section class="container container-e p-5 h-25">
      <div
        class="sub_tit_area d-flex justify-content-center align-items-center h-25"
      >
        <h1 class="fw-bold">결제하기</h1>
      </div>
      <hr />
      <div id="stage" class="d-flex flex-row-reverse">
        <div class="p-1">
          <span>① 조회</span>
          <span>② 예약</span>
          <span class="on">③ 결제</span>
          <span>④ 발권</span>
        </div>
      </div>
    </section>
    <!-- title end -->
    <section class="container mt-4">
      <div class="payment-info my-4">
        <ul>
          <li>결제 방법은 신용카드, 간편 결제 2가지가 있습니다.</li>
        </ul>
      </div>
      <div class="my-3">
        <table class="table">
          <tbody>
            <tr>
              <th scope="row" class="col-2 text-center">결제금액</th>
              <td class="amount-value col-8">76,100원</td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- 결제 UI -->
      <div id="payment-method" class="my-3"></div>
      <!-- 이용약관 UI -->
      <div id="agreement" class="my-3"></div>
      <!-- 여정 정보 -->
      <div class="travel-info-title fw-bold">여정 정보</div>
      <!-- table 1 -->
      <div class="container mt-4">
        <table class="table table-bordered table-top-border table-custom">
          <thead class="text-center">
            <tr>
              <th>승차일자</th>
              <th>열차종류</th>
              <th>열차번호</th>
              <th>출발역</th>
              <th>도착역</th>
              <th>출발시간</th>
              <th>도착시간</th>
              <th>인원</th>
              <th>결제금액</th>
            </tr>
          </thead>
          <tbody class="text-center">
            <tr>
              <td>8월 13일</td>
              <td>SRT</td>
              <td>319</td>
              <td>수서</td>
              <td>부산</td>
              <td>09:05</td>
              <td>11:51</td>
              <td>1</td>
              <td>76,100원</td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- table 2 -->
      <div class="container mt-4">
        <table class="table table-bordered table-top-border table-custom">
          <thead class="text-center">
            <tr>
              <th>열차번호</th>
              <th>객실등급</th>
              <th>좌석정보</th>
              <th colspan="2">승객유형</th>
              <th colspan="2">운임요금</th>
              <th>영수금액</th>
              <th>승차자명</th>
            </tr>
          </thead>
          <tbody class="text-center">
            <tr>
              <td>319</td>
              <td>특실</td>
              <td>3호차 9B</td>
              <td colspan="2">어른</td>
              <td colspan="2">76,100원</td>
              <td>76,100원</td>
              <td>김진아</td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- 결제하기 버튼 -->
      <div class="d-flex justify-content-center mb-4">
        <button class="btn btn-primary me-2" id="payment-button">
          결제 및 발권
        </button>
        <button class="btn btn-secondary" id="cancel-button">취소</button>
      </div>
    </section>
    <div id="footer1"></div>

    <!-- 토스 페이먼츠 API start -->
    <script>
      main();
      async function main() {
        const button = document.getElementById("payment-button");

        // ------  결제위젯 초기화 ------
        const clientKey = "test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm";
        const tossPayments = TossPayments(clientKey);
        // 회원 결제
        const customerKey = "ekUoFjyqlAjK1hPTicP4r";
        const widgets = tossPayments.widgets({
          customerKey,
        });
        // 비회원 결제
        // const widgets = tossPayments.widgets({ customerKey: TossPayments.ANONYMOUS });

        // ------ 주문의 결제 금액 설정 ------
        await widgets.setAmount({
          currency: "KRW",
          value: 50000,
        });

        await Promise.all([
          // ------  결제 UI 렌더링 ------
          widgets.renderPaymentMethods({
            selector: "#payment-method",
            variantKey: "DEFAULT",
          }),
          // ------  이용약관 UI 렌더링 ------
          widgets.renderAgreement({
            selector: "#agreement",
            variantKey: "AGREEMENT",
          }),
        ]);

        // ------  주문서의 결제 금액이 변경되었을 경우 결제 금액 업데이트 ------
        // coupon.addEventListener("change", async function () {
        //   if (coupon.checked) {
        //     await widgets.setAmount({
        //       currency: "KRW",
        //       value: amount.value - 5000,
        //     });

        //     return;
        //   }

        // await widgets.setAmount({
        //   currency: "KRW",
        //   value: amount,
        // });
        // });

        // ------ '결제하기' 버튼 누르면 결제창 띄우기 ------
        button.addEventListener("click", async function () {
          await widgets.requestPayment({
            orderId: "Ep2yZQD4N_0Swa_eA-v0F",
            orderName: "토스 티셔츠 외 2건",
            successUrl: window.location.origin + "/WebContent/payment/success.html",
            failUrl: window.location.origin + "/WebContent/payment/fail.html",
            customerEmail: "customer123@gmail.com",
            customerName: "김토스",
            customerMobilePhone: "01012341234",
          });
        });
        // 토스 페이먼츠 API end

        // 취소 버튼 기능 추가
        const cancelButton = document.getElementById("cancel-button");
        cancelButton.addEventListener("click", function () {
          if (confirm("선택하신 승차권 예약내역을 취소하시겠습니까?") == true) {
            //확인
            // document.removefrm.submit();
          } else {
            //취소
            return false;
          }
        });
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
